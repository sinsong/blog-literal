---
title: git
date: 2018-06-22 19:48:37
tags:
- git
---

# 概念 concept

## 三种状态
Git 有三种状态，你的文件可能处于其中之一。

* 已提交 committed
* 已修改 modified
* 已暂存 staged

## 三个工作区域

* 工作目录
* 暂存区域
* Git 仓库

工作目录：仓库中某个版本独立提取出来的内容。从 Git 仓库的压缩数据库中提取出来的文件，放在工作目录中供你修改。

暂存区域：是一个文件，保存了下次提交的文件列表信息，一般在 Git 仓库目录中。有时候也被称作“索引”，不过一般的说法叫暂存区域。

Git 仓库目录是 Git 用来保存仓库的元数据和对象数据库的地方。是 Git 最重要的部分，从其他计算机克隆仓库时，拷贝的就是这里的数据。

## 基本的 Git 工作流程

1. 在工作目录中修改文件。
2. 暂存文件，将文件的快照放入暂存区域。
3. 提交更新，找到暂存区域的文件，将快照“永久性的”储存到 Git 仓库目录。

如果 Git 目录中保存着特定版本的文件，属于已提交状态。
如果做了修改并已经放入暂存区域，就属于已暂存状态。
如果做了修改还没有放到暂存区域，就是已修改状态。

# 配置

## 配置相关概念

Git 自带`git config`的工具来帮助配置 Git。
分别存储在三个不同的位置：

1. `/etc/gitconfig`文件：包含系统上每个用户及他们仓库的通用配置。修改这里使用`--system`选项的`git config`。

2. `~/.gitconfig`或者`~/.config/git/config`文件：只针对当前用户。修改这里使用`--global`选项。

3. 当前使用仓库的 Git 目录中的`config`文件(`.git/config`)：针对该仓库。

每一级别覆盖上一个级别的配置。从一般到特殊。

## 用户信息

`user.name` 用户名
`user.email` 邮箱

安装完 Git 后，首先应该设置用户名和邮箱。这样做很重要！！！因为每个提交都会使用这些信息，而且会写入提交中，不可更改！

全局配置你的个人信息
```sh
$ git config --global user.name "someone"
$ git config --global user.email "someone@examplex.com"
```

## 文本编辑器
设置你喜欢的文本编辑器，当 Git 需要你输入信息时会调用它。未配置会使用系统默认的。
```sh
$ git config --global core.editor vim
```

## 检查配置

列出配置
```sh
$ git config --list
```
变量名重复？Git 会使用每一个变量的最后一个配置。

列出某一项配置

```sh
$ git config user.name
someone
```
# 帮助

```sh
$ git help <verb>
$ git <verb> --help
$ man git-<verb>
```

# 基础

## 初始化仓库（建库）

```sh
$ git init		#在工作目录下建立仓库

$ git init <dir-name>	#新建文件夹作为仓库
```

## 克隆仓库

```sh
$ git clone [url]

$ git clone https://github.com/git/git # 例子

$ git clone [远程仓库] [自定义本地仓库名字]
```

## 检查文件状态

```sh
$ git status
```

状态概览

`git status -s`或者`git status --short`输出会更紧凑。

`??`新添加的未跟踪文件
`A`新添加到暂存区的文件
`M`修改过的文件,左边的M表示问价修改了并放入了暂存区，右边的M表示文件修改了但是没有放入暂存区。

## 跟踪文件

```sh
$ git add <文件名字>

$ git add *.cpp #可以使用通配符
```

已经被跟踪的文件，修改后，也要用`git add`来暂存一下。

# 忽略文件

创建名为`.gitignore`在仓库根目录下，编写忽略列表。

格式规范：

* 所有空行会以`#`开头的行会被Git忽略。
* 可以使用标准的glob模式匹配。
匹配模式可以以`/`开头防止递归。
匹配模式可以以`/`结尾指定目录。
要忽略指定模式以外的文件或目录，可在模式前加上感叹号`!`取反。

glob模式是指shell所用的简化了的正则表达式。

## 查看已暂存和未暂存的修改

要查看尚未暂存的文件更新了哪些部分，不加参数直接输入 `git diff`

```sh
$ git diff
```

查看已暂存的将要添加到下次提交里的内容。
```sh
$ git diff --cached

$ git diff --staged #效果相同
```

## 提交

```sh
$ git commit
```
然后会启动文本编辑器以编辑本次提交的说明。
会有一些帮助你的文本。
想要更详细可以`git commit -v`

命令行指定提交信息会帮助迫不及待的你
```sh
$ git commit -m "提交信息"
```

跳过使用暂存区域

```sh 
$ git commit -a
```
自动将所有已经跟踪过的文件暂存起来一并提交。
未跟踪的新文件还得乖乖的`git add`一下。

## 移除文件

要从仓库中移除某个文件，必须从已跟踪文件清单中移除。使用`git rm`

```sh
$ git rm 文件名
```

从仓库中删除（从暂存区域中移除），但是希望保留在工作目录中。
```sh
$ git rm --cached 文件名
```
然后记得使用`.gitignore`

git rm 也可以使用通配符。

## 移动文件
文件改名也是用移动实现哟！

```sh
$ git mv 旧文件名 新文件名
```

## 查看提交历史

```sh 
$ git log
```

`-p` 显示每次提交内容差异。
`-#` `#`代表数字，仅显示最近几次提交。
`--stat` 显示每次提交的简略的统计信息。
`--pretty` 指定风格，选项有：`short`,`full`,`fuller`，用等号接上就行。
`--graph` 使用字符画展示历史。
`--decorate` 查看各个分支当前所指的对象

## 撤销操作

尝试重新提交
重写提交信息，如果忘记暂存某些修改，可以先`git add`然后再重新提交。

```sh
$ git commit --amend
```

不小心`git add *`暂存了修改，取消暂存
```sh
$ git reset HEAD <文件名>
```

撤销对文件的修改！
改的不满意！改回去！

```sh
$ git checkout -- <文件名>
```
这样文件会被覆盖成未修改的版本。注意你的修改会丢失的哟！

# 远程仓库

## 查看远程仓库

```sh
$ git remote	# 列出远程仓库简写
$ git remote -v	#列出远程仓库的简写与其对应的URL。
```

## 添加远程仓库

```sh
$ git remote add <简写名字> <url>
```

## 从远程仓库中拉取信息

```sh
$ git fetch <远程仓库名字>
```
注意不会自动合并或修改你当前的工作。自己准备好，并手动合并。
`git pull`能自动拉取和合并远程分支到当前分支。注意你的工作会飞。

## 推送到远程仓库

```sh
$ git push <远程仓库名字> <分支名字>
```
## 查看远程仓库

```sh
$ git remote show <简写名>
```

## 远程仓库的移除

```sh
$ git remote rm <简写>
```

## 远程仓库重命名

```sh
$ git remote rename <旧名字> <新名字>
```

# 标签

## 列出标签

```sh
$ git tag
```

特定模式寻找标签
```sh
$ git tag -l <模式>
```

## 创建标签

### 附注标签
Git 数据库中的一个完整对象。可以校验。还有标签信息。通常建议创建附注标签。

```sh
$ git tag -a <标签名> -m <说明>
```

`git show <标签名>`可以看到标签信息和提交信息。

### 轻量标签
将提交校验和储存到一个文件中，没有保存任何其他信息。
创建轻量标签不需要`-a`,`-s`,`-m`，只需要提供标签名字。

```sh
$ git tag <标签名>
```

### 后期打标签

```sh
$ git tag -a <标签名> <校验和>
```

## 共享标签

默认情况下，`git push`不会推送标签。
可以运行`git push <远程仓库名字> [标签名]`

专门推送很多标签

```sh
$ git push <远程仓库名字> --tags
```

## 使用标签

想要工作目录与仓库中某个标签版本完全一样，使用`git checkout -b [分支名] [标签名]`在特定的标签上创建一个新分支。

```sh
$ git checkout -b last-ver v-last
```
这样会有一个新分支，与标签的版本一毛一样。
如果你往这个分支玩提交，当然会不一样啦！

# 分支

创建分支
```sh
$ git branch <分支名>
```

新建分支，同时切换过去
```sh
$ git checkout -b <分支名>
```

分支切换

```sh
$ git checkout <分支名>
```

列出分支

```sh
$ git branck
```
`*`表示我们当前所处的分支。
`git branch -v`附带每个分支的最后一次提交。
`--merged`查看那些分支合并到当前分支
`--no-merged`查看所有包含未合并工作的分支

删除分支

```sh
$ git branch -d <分支名>
```

# 分支合并

将一个分支合并到当前分支上
```sh
$ git merge <分支名>
```

遇到冲突的话

用`git status`来查看因为冲突而未合并的文件。
自己手动解决冲突。

然后`git commit`完成合并提交。

# 远程分支

`git ls-remote (remote)`获得远程引用的完整列表
`git remote show (remote)`获得远程分支的更多信息


